<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÛŒØ³ØªÛ•Ù…ÛŒ Ú©Ø§Ø±Ú¯ÛÚ•ÛŒ Ø¦Û†ØªÛ†Ù…Ø¨ÛÙ„</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <style>
        :root {
            --primary: #3498db; --success: #2ecc71; --danger: #e74c3c; --warning: #f1c40f; --dark: #2c3e50;
        }

        body {
            font-family: 'Segoe UI', Tahoma, sans-serif; background-color: #f0f2f5;
            margin: 0; padding: 20px; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh;
        }

        .container {
            max-width: 550px; width: 100%; background: white; padding: 30px; border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1); margin-top: 20px;
        }

        h2 { text-align: center; color: var(--dark); margin-bottom: 25px; border-bottom: 2px solid #eee; padding-bottom: 10px; }

        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #666; }

        input, select {
            padding: 12px; border: 2px solid #eee; border-radius: 10px; font-size: 16px;
            width: 100%; box-sizing: border-box; outline: none; transition: 0.3s;
        }

        input:focus { border-color: var(--primary); background-color: #f0f8ff; }

        .button-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;
        }

        button {
            padding: 12px; border: none; border-radius: 10px; cursor: pointer;
            font-weight: bold; color: white; transition: 0.3s;
        }

        .btn-save { background-color: var(--success); grid-column: span 2; }
        .btn-search { background-color: var(--primary); }
        .btn-clear { background-color: #95a5a6; }
        .btn-update { background-color: var(--warning); color: #333; display: none; }
        .btn-delete { background-color: var(--danger); display: none; }

        #searchResults { margin-top: 20px; border-top: 2px solid #eee; display: none; }
        .search-item {
            background: #f9f9f9; padding: 10px; margin-top: 10px; border-radius: 8px;
            cursor: pointer; border: 1px solid #ddd; transition: 0.2s;
            display: flex; justify-content: space-between; align-items: center;
        }
        .search-item:hover { background: #eef7ff; border-color: var(--primary); }
    </style>
</head>
<body>

<div class="container">
    <h2>Ø³Û•Ø±Ù¾Û•Ø±Ø´ØªÛŒ Ø¦Û†ØªÛ†Ù…Ø¨ÛÙ„</h2>
    
    <input type="hidden" id="docId">

    <div class="form-group">
        <label>Ú˜Ù…Ø§Ø±Û•ÛŒ Ø¦Û†ØªÛ†Ù…Ø¨ÛÙ„:</label>
        <input type="text" id="carNumber" placeholder="Ú˜Ù…Ø§Ø±Û•Ú©Û• Ù„ÛØ±Û• Ø¨Ù†ÙˆÙˆØ³Û•..." autofocus>
    </div>

    <div class="form-group">
        <label>Ù‡ÛÚµ:</label>
        <select id="carLine">
            <option value="" disabled selected>Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</option>
            <option value="Ù‡Û•ÙˆÙ„ÛØ±">Ù‡Û•ÙˆÙ„ÛØ±</option>
            <option value="Ú©Û•Ø±Ú©ÙˆÚ©">Ú©Û•Ø±Ú©ÙˆÚ©</option>
            <option value="Ú•Ø§Ù†ÛŒÛ•">Ú•Ø§Ù†ÛŒÛ•</option>
            <option value="Ù‚Û•ÚµØ§Ø¯Ø²Û">Ù‚Û•ÚµØ§Ø¯Ø²Û</option>
            <option value="Ø¨ØºØ¯Ø§Ø¯">Ø¨ØºØ¯Ø§Ø¯</option>
            <option value="Ú†Û•Ù…Ú†Û•Ù…Ø§Úµ">Ú†Û•Ù…Ú†Û•Ù…Ø§Úµ</option>
            <option value="Ø¯ÙˆÙˆØ²">Ø¯ÙˆÙˆØ²</option>
            <option value="Ú©Û†ÛŒÛ•">Ú©Û†ÛŒÛ•</option>
        </select>
    </div>

    <div class="form-group">
        <label>Ù†Ø±Ø®:</label>
        <select id="carPrice">
            <option value="" disabled selected>Ù†Ø±Ø® Ø¯ÛŒØ§Ø±ÛŒ Ø¨Ú©Û•</option>
            <option value="1000">1000</option>
            <option value="2000">2000</option>
            <option value="3000">3000</option>
            <option value="4000">4000</option>
            <option value="5000">5000</option>
            <option value="6000">6000</option>
            <option value="6500">6500</option>
            <option value="10000">10000</option>
            <option value="15000">15000</option>
        </select>
    </div>

    <div class="form-group">
        <label>Ø¬Û†Ø±:</label>
        <select id="carType">
            <option value="" disabled selected>Ø¬Û†Ø±Û•Ú©Û• Ø¯ÛŒØ§Ø±ÛŒ Ø¨Ú©Û•</option>
            <option value="ØªÛ•Ú©Ø³ÛŒ">ØªÛ•Ú©Ø³ÛŒ</option>
            <option value="Ù¾Ø§Ø³">Ù¾Ø§Ø³</option>
        </select>
    </div>

    <div class="button-grid">
        <button id="saveBtn" class="btn-save" onclick="saveData()">ğŸ’¾ Ø®Û•Ø²Ù†Ú©Ø±Ø¯Ù†</button>
        <button id="updateBtn" class="btn-update" onclick="updateData()">ğŸ”„ Ù†ÙˆÛÚ©Ø±Ø¯Ù†Û•ÙˆÛ•</button>
        <button id="deleteBtn" class="btn-delete" onclick="deleteData()">ğŸ—‘ï¸ Ø³Ú•ÛŒÙ†Û•ÙˆÛ•</button>
        <button class="btn-search" onclick="searchCar()">ğŸ” Ú¯Û•Ú•Ø§Ù†</button>
        <button class="btn-clear" onclick="clearInputs()">âœ¨ Ù¾Ø§Ú©Ú©Ø±Ø¯Ù†Û•ÙˆÛ•</button>
    </div>

    <div id="searchResults">
        <p style="font-size: 14px; color: #888; margin-top: 15px;">Ø¦Û•Ù†Ø¬Ø§Ù…Û•Ú©Ø§Ù†:</p>
        <div id="resultsList"></div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCuUstd-6d0E-EbmQipv2mWk-bA55ajpQ0",
        authDomain: "car-system-4594d.firebaseapp.com",
        projectId: "car-system-4594d",
        storageBucket: "car-system-4594d.firebasestorage.app",
        messagingSenderId: "719030469585",
        appId: "1:719030469585:web:7a23645b9e684b727dd6f0"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function saveData() {
        const num = document.getElementById('carNumber').value.trim();
        const line = document.getElementById('carLine').value;
        const price = document.getElementById('carPrice').value;
        const type = document.getElementById('carType').value;

        if(!num || !line || !price || !type) return alert("Ø®Ø§Ù†Û•Ú©Ø§Ù† Ù¾Ú• Ø¨Ú©Û•Ø±Û•ÙˆÛ•");

        const dup = await db.collection("Cars").where("number","==",num).where("line","==",line).get();
        if(!dup.empty) return alert("Ø¦Û•Ù… Ú˜Ù…Ø§Ø±Û•ÛŒÛ• Ù¾ÛØ´ØªØ± ØªÛ†Ù…Ø§Ø± Ú©Ø±Ø§ÙˆÛ•!");

        await db.collection("Cars").add({ number: num, line: line, price: price, type: type, time: firebase.firestore.FieldValue.serverTimestamp() });
        alert("Ø®Û•Ø²Ù† Ú©Ø±Ø§");
        clearInputs();
    }

    async function searchCar() {
        const num = document.getElementById('carNumber').value.trim();
        if(!num) return alert("Ø¨Û† Ú¯Û•Ú•Ø§Ù† Ú˜Ù…Ø§Ø±Û• Ø¨Ù†ÙˆÙˆØ³Û•");

        const snap = await db.collection("Cars").where("number", "==", num).get();
        const resultsDiv = document.getElementById('searchResults');
        const listDiv = document.getElementById('resultsList');
        listDiv.innerHTML = "";
        
        if (snap.empty) {
            resultsDiv.style.display = 'none';
            alert("Ù‡ÛŒÚ† Ø¦Û•Ù†Ø¬Ø§Ù…ÛÚ© Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•");
            document.getElementById('carNumber').focus();
        } else {
            resultsDiv.style.display = 'block';
            snap.forEach(doc => {
                const data = doc.data();
                listDiv.innerHTML += `
                    <div class="search-item" onclick="selectForEdit('${doc.id}', '${data.number}', '${data.line}', '${data.price}', '${data.type}')">
                        <span><b>${data.line}</b></span>
                        <span>${data.type} - ${data.price}</span>
                    </div>`;
            });
        }
    }

    function selectForEdit(id, num, line, price, type) {
        document.getElementById('docId').value = id;
        document.getElementById('carNumber').value = num;
        document.getElementById('carLine').value = line;
        document.getElementById('carPrice').value = price;
        document.getElementById('carType').value = type;
        document.getElementById('updateBtn').style.display = 'block';
        document.getElementById('deleteBtn').style.display = 'block';
        document.getElementById('saveBtn').style.display = 'none';
        document.getElementById('searchResults').style.display = 'none';
        document.getElementById('carNumber').focus();
    }

    async function updateData() {
        const id = document.getElementById('docId').value;
        if(!id) return;
        await db.collection("Cars").doc(id).update({
            number: document.getElementById('carNumber').value.trim(),
            line: document.getElementById('carLine').value,
            price: document.getElementById('carPrice').value,
            type: document.getElementById('carType').value
        });
        alert("Ù†ÙˆÛÚ©Ø±Ø§ÛŒÛ•ÙˆÛ•");
        clearInputs();
    }

    async function deleteData() {
        const id = document.getElementById('docId').value;
        if(id && confirm("Ø¯ÚµÙ†ÛŒØ§ÛŒØŸ")) {
            await db.collection("Cars").doc(id).delete();
            alert("Ø³Ú•Ø§ÛŒÛ•ÙˆÛ•");
            clearInputs();
        }
    }

    function clearInputs() {
        document.getElementById('docId').value = "";
        document.getElementById('carNumber').value = "";
        document.getElementById('carLine').selectedIndex = 0;
        document.getElementById('carPrice').selectedIndex = 0;
        document.getElementById('carType').selectedIndex = 0;
        document.getElementById('updateBtn').style.display = 'none';
        document.getElementById('deleteBtn').style.display = 'none';
        document.getElementById('saveBtn').style.display = 'block';
        document.getElementById('searchResults').style.display = 'none';
        
        // Ø¦Û•Ù… Ø¯ÛÚ•Û• Ø®Ø§Ù†Û•Ú©Û• Ú†Ø§Ù„Ø§Ú© Ø¯Û•Ú©Ø§ØªÛ•ÙˆÛ•
        document.getElementById('carNumber').focus();
    }
</script>
</body>
</html>
